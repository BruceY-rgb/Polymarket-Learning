# Polymarket套利交易系统

一个用于检测和执行Polymarket套利交易机会的自动化交易系统。

## ⚠️ 重要声明

**风险警告**: 此系统用于教育和研究目的。加密货币交易存在重大风险，可能导致资金全部亏损。使用此系统前，请确保：

1. 充分理解相关风险
2. 仅使用您能承受损失的资金
3. 在测试网络上充分测试
4. 了解相关法律法规

作者不对使用此系统造成的任何损失承担责任。

## 📋 系统概述

该系统通过以下步骤工作：

1. **市场扫描**: 从Gamma API获取活跃的Polymarket市场
2. **订单簿监控**: 通过WebSocket实时监控价格变动
3. **套利检测**: 当Yes和No代币总成本低于阈值时检测套利机会
4. **自动执行**: 自动执行套利交易以获取利润

## 🏗️ 项目结构

```
Polymarket/
├── src/                    # 源代码目录
│   ├── __init__.py        # 包初始化文件
│   ├── config.py          # 配置管理
│   ├── scanner.py         # 市场扫描模块
│   ├── monitor.py         # 订单簿监控模块
│   ├── executor.py        # 交易执行模块
│   └── settler.py         # 链上结算模块
├── main.py                # 主启动文件
├── requirements.txt       # Python依赖
├── .env.example          # 环境变量模板
└── README.md             # 项目文档
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置环境变量

```bash
# 复制环境变量模板
cp .env.example .env

# 编辑.env文件，填入您的配置
```

必需配置：
- `PRIVATE_KEY`: 您的钱包私钥

可选配置：
- `RPC_PROVIDER`: Polygon RPC节点（默认：公共节点）
- `ARBITRAGE_THRESHOLD`: 套利阈值（默认：0.005 = 0.5%）
- `DEFAULT_ORDER_SIZE`: 默认订单大小（默认：100）
- `VERBOSE`: 是否启用详细日志（默认：false）

### 3. 运行系统

```bash
python main.py
```

## 📦 模块说明

### Scanner (`scanner.py`)
- 从Gamma API获取活跃市场列表
- 解析市场元数据并提取Token ID

### Monitor (`monitor.py`)
- 通过WebSocket连接Polymarket订单簿
- 实时监控价格变动
- 检测套利机会

### Executor (`executor.py`)
- 执行下单操作
- 并发下单以降低风险
- 包含错误处理和回滚机制

### Settler (`settler.py`)
- 在Polygon区块链上执行合并操作
- 将Yes和No代币合并为USDC

### Config (`config.py`)
- 集中管理所有配置
- 环境变量支持
- 配置验证

## 🔧 配置说明

### 私钥设置

您需要提供一个有效的私钥来签名交易：

```bash
PRIVATE_KEY=0x1234567890abcdef...
```

**安全提示**:
- 绝不要将私钥提交到版本控制系统
- 考虑使用专用账户而非主账户
- 在测试网络上测试后再使用主网

### RPC节点

建议使用专业的RPC提供商：
- Alchemy (推荐): https://www.alchemy.com/
- Infura: https://infura.io/
- QuickNode: https://www.quicknode.com/

### 套利阈值

设置合理的阈值非常重要：
- 过高：很少触发交易
- 过低：可能无利可图

建议从0.5%开始测试：
```bash
ARBITRAGE_THRESHOLD=0.005
```

## 🛠️ 开发

### 架构设计

系统采用模块化设计，各模块职责分离：

```
┌─────────────┐    ┌──────────────┐    ┌─────────────┐
│  Scanner    │ -> │   Monitor    │ -> │  Executor   │
│             │    │              │    │             │
│ 市场扫描    │    │ 订单簿监控   │    │ 交易执行    │
└─────────────┘    └──────────────┘    └─────────────┘
                           │
                           v
                   ┌──────────────┐
                   │   Settler    │
                   │              │
                   │ 链上结算     │
                   └──────────────┘
```

### 扩展开发

您可以通过继承或修改现有模块来扩展功能：

1. 添加新的套利策略
2. 支持更多市场类型
3. 增加风险管理功能
4. 集成更多数据源

## 📊 监控和日志

系统提供详细的日志输出：

- 市场扫描结果
- WebSocket连接状态
- 价格变动
- 套利机会检测
- 交易执行结果

设置 `VERBOSE=true` 获取更多详细信息。

## ⚠️ 注意事项

1. **Gas费用**: 所有链上操作都需要支付Gas费用
2. **滑点**: 市场波动可能导致实际成交价格与预期不同
3. **网络延迟**: WebSocket连接可能因网络问题断开
4. **API限制**: 请遵守API调用频率限制
5. **资金安全**: 建议使用专用测试账户

## 🐛 故障排除

### 常见问题

**Q: WebSocket连接失败**
A: 检查网络连接和防火墙设置

**Q: 交易执行失败**
A: 确认私钥正确、账户有足够余额、Gas价格合理

**Q: 检测不到套利机会**
A: 调整套利阈值，或检查市场流动性

**Q: 订单簿数据不完整**
A: 某些市场可能没有完整的Yes/No订单簿

### 调试模式

启用详细日志：
```bash
VERBOSE=true python main.py
```

## 📄 许可证

本项目仅用于教育和研究目的。使用前请确保遵守当地法律法规。

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目。

## 📞 支持

如果您遇到问题或有建议，请：
1. 查看本文档的故障排除部分
2. 搜索现有的Issue
3. 创建新的Issue并提供详细信息

---

**免责声明**: 本软件按"原样"提供，不提供任何明示或暗示的担保。使用者应自行承担使用风险。作者不对任何直接或间接的损失承担责任。
