# Polymarket æ•°æ®æ”¶é›†æ•…éšœæ’é™¤æŒ‡å—

## ğŸ¯ æ–°ç­–ç•¥è¯´æ˜

### åŠå¹´å›æº¯ç­–ç•¥
ç°åœ¨ç®¡é“é»˜è®¤ä»**æœ€æ–°æ•°æ®å¼€å§‹**ï¼Œå‘å‰å›æº¯**åŠå¹´ï¼ˆ180å¤©ï¼‰**ã€‚

**ä¼˜åŠ¿**ï¼š
- âœ… é¦–æ¬¡è¿è¡Œåªéœ€å‡ åˆ†é’Ÿ
- âœ… ä¼˜å…ˆè·å–æœ€æ–°æ•°æ®
- âœ… èŠ‚çœå­˜å‚¨ç©ºé—´
- âœ… é€‚åˆå®æ—¶ç›‘æ§

**ä½¿ç”¨**ï¼š
```bash
# é»˜è®¤åŠå¹´å›æº¯
uv run python -c "from update_utils.update_goldsky import update_goldsky; update_goldsky()"

# è‡ªå®šä¹‰å›æº¯å¤©æ•°
uv run python -c "from update_utils.update_goldsky import update_goldsky; update_goldsky(days_limit=90)"
```

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š`æ–°åŠå¹´å›æº¯ç­–ç•¥è¯´æ˜.md`

## é—®é¢˜è¯Šæ–­

### ğŸ” å½“å‰çŠ¶æ€æ£€æŸ¥

é¦–å…ˆè¿è¡Œç­–ç•¥æµ‹è¯•å’Œ API è¯Šæ–­ï¼š

```bash
cd /Users/yangsmac/Desktop/Polymarket/poly_data

# 1. æµ‹è¯•å›æº¯ç­–ç•¥
uv run python test_backward_strategy.py

# 2. æ£€æŸ¥ API è¿æ¥
uv run python test_apis.py
```

### ğŸ“Š æ•°æ®æ–‡ä»¶çŠ¶æ€

é¡¹ç›®ä¾èµ–ä¸‰ä¸ªä¸»è¦æ•°æ®æ–‡ä»¶ï¼š

| æ–‡ä»¶ | çŠ¶æ€ | å¤§å° | æè¿° |
|------|------|------|------|
| `markets.csv` | âŒ ç©º | 112B | å¸‚åœºå…ƒæ•°æ®ï¼ˆåªæœ‰æ ‡é¢˜è¡Œï¼‰ |
| `goldsky/orderFilled.csv` | âŒ ä¸å­˜åœ¨ | - | è®¢å•æˆäº¤äº‹ä»¶ |
| `processed/trades.csv` | âŒ ä¸å­˜åœ¨ | - | å¤„ç†åçš„äº¤æ˜“æ•°æ® |

**é—®é¢˜**ï¼šé¡¹ç›®æ ¹æœ¬æ²¡æœ‰æˆåŠŸæ”¶é›†åˆ°ä»»ä½•æ•°æ®ï¼

## å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆ

### 1. API è®¿é—®é—®é¢˜

#### ç—‡çŠ¶
- HTTP é”™è¯¯ï¼ˆ403, 429, 500ï¼‰
- è¿æ¥è¶…æ—¶
- GraphQL è§£æé”™è¯¯

#### è§£å†³æ–¹æ¡ˆ

**æ£€æŸ¥ç½‘ç»œè¿æ¥**ï¼š
```bash
# æµ‹è¯•åŸºæœ¬ç½‘ç»œè¿é€šæ€§
ping gamma-api.polymarket.com
ping api.goldsky.com

# æµ‹è¯• API ç«¯ç‚¹
curl -v "https://gamma-api.polymarket.com/markets?limit=1"
```

**API é™æµå¤„ç†**ï¼š
- 429 é”™è¯¯è¡¨ç¤ºè¾¾åˆ°é€Ÿç‡é™åˆ¶
- é¡¹ç›®å·²å†…ç½®é‡è¯•æœºåˆ¶ï¼ˆ5-10 ç§’é€€é¿ï¼‰
- é•¿æ—¶é—´è¿è¡Œå¯èƒ½éœ€è¦è°ƒæ•´è¯·æ±‚é—´éš”

### 2. æ—¶é—´èŒƒå›´é™åˆ¶

#### é—®é¢˜åˆ†æ
é¡¹ç›®é»˜è®¤åªè·å–æœ€è¿‘ä¸€å¹´çš„æ•°æ®ï¼Œå¯èƒ½å¯¼è‡´å†å²æ•°æ®ç¼ºå¤±ã€‚

#### è§£å†³æ–¹æ¡ˆ

**ä¿®æ”¹æ—¶é—´èŒƒå›´**ï¼š
```python
# åœ¨ update_utils/update_goldsky.py ä¸­
DEFAULT_DAYS_LIMIT = 10000  # è®¾ç½®ä¸ºçº¦ 27 å¹´ï¼Œè·å–æ‰€æœ‰å†å²æ•°æ®
```

**æ‰‹åŠ¨æŒ‡å®šæ—¶é—´èŒƒå›´**ï¼š
```bash
# è·å–æ‰€æœ‰å†å²æ•°æ®
uv run python -c "from update_utils.update_goldsky import update_goldsky; update_goldsky(days_limit=10000)"
```

### 3. ä¾èµ–é—®é¢˜

#### æ£€æŸ¥ä¾èµ–
```bash
# æ£€æŸ¥ Python ç¯å¢ƒ
which python
python --version

# æ£€æŸ¥ä¾èµ–åŒ…
uv sync --extra dev
```

#### å¸¸è§ä¾èµ–é”™è¯¯

**`ModuleNotFoundError: No module named 'gql'`**ï¼š
```bash
uv add gql
```

**`ModuleNotFoundError: No module named 'polars'`**ï¼š
```bash
uv add polars
```

**`ModuleNotFoundError: No module named 'flatten_json'`**ï¼š
```bash
uv add flatten-json
```

### 4. æ–‡ä»¶æƒé™é—®é¢˜

#### ç—‡çŠ¶
- `Permission denied` é”™è¯¯
- æ— æ³•åˆ›å»ºç›®å½•æˆ–æ–‡ä»¶

#### è§£å†³æ–¹æ¡ˆ
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la /Users/yangsmac/Desktop/Polymarket/poly_data/

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p goldsky
mkdir -p processed

# ç¡®ä¿æœ‰å†™å…¥æƒé™
chmod 755 /Users/yangsmac/Desktop/Polymarket/poly_data/
```

### 5. æ•°æ®æ ¼å¼é—®é¢˜

#### ç—‡çŠ¶
- CSV è§£æé”™è¯¯
- JSON æ ¼å¼å¼‚å¸¸
- å­—æ®µç¼ºå¤±

#### æ£€æŸ¥æ–¹æ³•
```bash
# æŸ¥çœ‹åŸå§‹ API å“åº”
curl "https://gamma-api.polymarket.com/markets?limit=1" | jq '.'

# æ£€æŸ¥ CSV æ–‡ä»¶æ ¼å¼
head -n 5 markets.csv
```

## åˆ†æ­¥æ‰§è¡ŒæŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šæµ‹è¯• API è¿æ¥

```bash
cd /Users/yangsmac/Desktop/Polymarket/poly_data
uv run python test_apis.py
```

**æœŸæœ›è¾“å‡º**ï¼š
```
âœ… Polymarket API: æ­£å¸¸
âœ… Goldsky API: æ­£å¸¸
```

### ç¬¬äºŒæ­¥ï¼šæ‰‹åŠ¨æ”¶é›†å¸‚åœºæ•°æ®

```bash
# å•ç‹¬è¿è¡Œå¸‚åœºæ›´æ–°
from update_utils.update_markets import update_markets
print('å¼€å§‹æ›´æ–°å¸‚åœºæ•°æ®...')
update_markets()
print('å¸‚åœºæ•°æ®æ›´æ–°å®Œæˆï¼')
"
```

**æ£€æŸ¥ç»“æœ**ï¼š
```bash
# æŸ¥çœ‹æ–‡ä»¶å¤§å°
ls -lah markets.csv

# æŸ¥çœ‹æ•°æ®æ ·æœ¬
head -n 5 markets.csv
```

### ç¬¬ä¸‰æ­¥ï¼šæ‰‹åŠ¨æ”¶é›†è®¢å•æ•°æ®

```bash
# å•ç‹¬è¿è¡Œ Goldsky æ›´æ–°
uv run python -c "
from update_utils.update_goldsky import update_goldsky
print('å¼€å§‹æ›´æ–° Goldsky æ•°æ®...')
update_goldsky(days_limit=10000)  # è·å–æ‰€æœ‰å†å²æ•°æ®
print('Goldsky æ•°æ®æ›´æ–°å®Œæˆï¼')
"
```

**æ£€æŸ¥ç»“æœ**ï¼š
```bash
# æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
ls -lah goldsky/

# æŸ¥çœ‹è®¢å•æ•°æ®æ ·æœ¬
head -n 5 goldsky/orderFilled.csv
```

### ç¬¬å››æ­¥ï¼šå¤„ç†äº¤æ˜“æ•°æ®

```bash
# å•ç‹¬è¿è¡Œäº¤æ˜“å¤„ç†
uv run python -c "
from update_utils.process_live import process_live
print('å¼€å§‹å¤„ç†äº¤æ˜“æ•°æ®...')
process_live()
print('äº¤æ˜“æ•°æ®å¤„ç†å®Œæˆï¼')
"
```

**æ£€æŸ¥ç»“æœ**ï¼š
```bash
# æ£€æŸ¥å¤„ç†åçš„æ–‡ä»¶
ls -lah processed/

# æŸ¥çœ‹äº¤æ˜“æ•°æ®æ ·æœ¬
head -n 5 processed/trades.csv
```

## å®Œæ•´æµç¨‹

### ä¸€é”®è¿è¡Œæ‰€æœ‰æ­¥éª¤

```bash
cd /Users/yangsmac/Desktop/Polymarket/poly_data

# ç¡®ä¿ä¾èµ–å·²å®‰è£…
uv sync --extra dev

# è¿è¡Œå®Œæ•´ç®¡é“
uv run python update_all.py
```

### ç›‘æ§è¿›åº¦

è¿è¡Œæ—¶ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
æ­£åœ¨æ›´æ–°å¸‚åœºæ•°æ®
åœ¨åç§» 0 å¤„è·å–æ‰¹æ¬¡...
æ‰¾åˆ° 0 ä¸ªç°æœ‰è®°å½•ã€‚ä»åç§» 0 æ¢å¤
...
```

## é«˜çº§æ•…éšœæ’é™¤

### å¯ç”¨è¯¦ç»†æ—¥å¿—

```python
# åœ¨è„šæœ¬å¼€å¤´æ·»åŠ 
import logging
logging.basicConfig(level=è°ƒè¯•çº§åˆ«)
```

### æ£€æŸ¥ GraphQL æŸ¥è¯¢

```python
# åœ¨ update_goldsky.py ä¸­æ·»åŠ 
print(f"GraphQL Query: {q_string}")
print(f"Response: {res}")
```

### å†…å­˜ä¼˜åŒ–

å¯¹äºå¤§å‹æ•°æ®é›†ï¼š

```python
# ä½¿ç”¨æµå¼å¤„ç†
df = pl.scan_csv("large_file.csv").collect(streaming=True)

# åˆ†æ‰¹å¤„ç†
batch_size = 1000
for batch in pd.read_csv("large_file.csv", chunksize=batch_size):
    process(batch)
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç½‘ç»œä¼˜åŒ–
- ä½¿ç”¨ç¨³å®šçš„ç½‘ç»œè¿æ¥
- è€ƒè™‘ä½¿ç”¨ä»£ç†ï¼ˆå¦‚éœ€è¦ï¼‰
- é¿å…åœ¨ç½‘ç»œé«˜å³°æ—¶æ®µè¿è¡Œ

### 2. å­˜å‚¨ä¼˜åŒ–
- å®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶
- å‹ç¼©å†å²æ•°æ®
- ä½¿ç”¨ SSD å­˜å‚¨æå‡ I/O æ€§èƒ½

### 3. è®¡ç®—ä¼˜åŒ–
- è°ƒæ•´æ‰¹å¤„ç†å¤§å°
- ä½¿ç”¨å¤šè¿›ç¨‹å¹¶è¡Œå¤„ç†
- å¯ç”¨æ•°æ®ç¼“å­˜

## è·å–å¸®åŠ©

### æ”¶é›†è¯Šæ–­ä¿¡æ¯

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¹¶ä¿å­˜è¾“å‡ºï¼š

```bash
# ç³»ç»Ÿä¿¡æ¯
python --version
uv --version

# ä¾èµ–åˆ—è¡¨
uv pip list

# é¡¹ç›®ç»“æ„
tree -L 2

# è¯Šæ–­ç»“æœ
uv run python test_apis.py > diagnosis.log 2>&1
```

### å¸¸è§é”™è¯¯æ¶ˆæ¯

| é”™è¯¯ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| `ConnectionError` | ç½‘ç»œé—®é¢˜ | æ£€æŸ¥ç½‘ç»œè¿æ¥ |
| `429 Too Many Requests` | API é™æµ | ç­‰å¾…æˆ–å¢åŠ å»¶è¿Ÿ |
| `500 Internal Server Error` | API æœåŠ¡å™¨é—®é¢˜ | ç¨åé‡è¯• |
| `Permission denied` | æ–‡ä»¶æƒé™ | æ£€æŸ¥ç›®å½•æƒé™ |
| `No module named 'xxx'` | ä¾èµ–ç¼ºå¤± | `uv add xxx` |

## æ•°æ®å¿«ç…§

å¦‚æœ API é—®é¢˜æŒç»­å­˜åœ¨ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨é¢„æ„å»ºçš„æ•°æ®å¿«ç…§ï¼š

**å®˜æ–¹æ•°æ®å¿«ç…§**ï¼š
```
https://polydata-archive.s3.us-east-1.amazonaws.com/archive.tar.xz
```

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# ä¸‹è½½å¹¶è§£å‹
wget https://polydata-archive.s3.us-east-1.amazonaws.com/archive.tar.xz
tar -xJf archive.tar.xz

# ç§»åŠ¨åˆ°é¡¹ç›®ç›®å½•
mv poly_data/* ./
```
