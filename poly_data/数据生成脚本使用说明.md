# Polymarket 数据生成脚本使用说明

## 📁 概述

本项目提供三个独立的脚本，用于生成180天内的Polymarket市场数据。所有数据文件将生成在 `/Users/yangsmac/Desktop/poly_data` 目录下。

## 🗂️ 输出文件

所有文件均生成在：`/Users/yangsmac/Desktop/poly_data/`

1. **markets.csv** - 市场元数据（最近180天）
2. **orderFilled.csv** - 订单成交数据（最近180天）
3. **trades.csv** - 处理后的交易数据（基于orderFilled.csv生成）

## 🚀 使用方法

### 1. 生成市场数据 (markets.csv)

```bash
python generate_markets.py
```

- 获取最近180天的市场数据
- 输出：`/Users/yangsmac/Desktop/poly_data/markets.csv`
- 预计时间：1-2分钟
- 预计数据量：约300-500条市场记录

### 2. 生成订单数据 (orderFilled.csv)

```bash
python generate_orders.py
```

- 获取最近180天的订单成交数据
- 输出：`/Users/yangsmac/Desktop/poly_data/orderFilled.csv`
- 预计时间：5-10分钟（取决于网络和API响应速度）
- 预计数据量：约50万-100万条记录

### 3. 生成交易数据 (trades.csv)

```bash
python generate_trades.py
```

- 基于 orderFilled.csv 生成处理后的交易数据
- 输入：`/Users/yangsmac/Desktop/poly_data/orderFilled.csv`
- 输出：`/Users/yangsmac/Desktop/poly_data/trades.csv`
- 预计时间：1-3分钟
- 需要先运行 generate_orders.py

## 📋 执行顺序

**推荐执行顺序：**

```bash
# 1. 先生成市场数据
python generate_markets.py

# 2. 再生成订单数据
python generate_orders.py

# 3. 最后生成交易数据
python generate_trades.py
```

## ⚙️ 核心修改

### 修复的问题

1. **修复了停止逻辑错误**
   - `update_markets.py`：修正了检查API返回数而非实际处理数的错误
   - `update_goldsky.py`：修正了批次不满就停止的错误

2. **统一了文件路径**
   - 所有文件输出到 `/Users/yangsmac/Desktop/poly_data/` 目录
   - 不再使用子目录（goldsky/, processed/）

3. **创建了独立脚本**
   - 三个独立的生成脚本，互不影响
   - 每个脚本可单独运行和调试

## 🔧 技术细节

### 时间范围控制

- 默认时间范围：180天（半年）
- 数据抓取策略：从最新数据开始，向前回溯指定天数
- 时间范围检查：确保不获取超出180天的旧数据

### 停止条件

- **markets**: 只有API返回空结果或连续多次无有效数据时停止
- **orderFilled**: 到达180天时间边界或API无返回时停止
- **trades**: 基于输入文件处理，无停止问题

### 数据去重

- 所有脚本都包含数据去重逻辑
- 基于唯一ID确保数据完整性

## 🐛 故障排除

### 问题1：生成markets.csv失败

**可能原因**：
- API速率限制
- 网络连接问题

**解决方案**：
- 等待一段时间后重试
- 检查网络连接

### 问题2：生成orderFilled.csv提前停止

**已修复**：更新了停止逻辑，确保完整抓取180天数据

### 问题3：生成trades.csv失败

**可能原因**：
- 未找到 orderFilled.csv 文件
- orderFilled.csv 文件损坏

**解决方案**：
- 确保已先运行 generate_orders.py
- 检查 orderFilled.csv 文件是否存在

## 📊 预期结果

成功执行所有脚本后，您将在 `/Users/yangsmac/Desktop/poly_data/` 目录下看到：

```
/Users/yangsmac/Desktop/poly_data/
├── markets.csv          (~500KB, 300-500条记录)
├── orderFilled.csv      (~50-100MB, 50万-100万条记录)
└── trades.csv          (~30-60MB, 处理后的交易数据)
```

## 💡 提示

- 可以并行运行 markets 和 orders 脚本，它们相互独立
- 建议先运行 markets 脚本，因为它执行最快，可以验证基本功能
- 如果只需要市场数据分析，运行 markets.py 就足够了
- 如果需要交易分析，需要运行所有三个脚本
