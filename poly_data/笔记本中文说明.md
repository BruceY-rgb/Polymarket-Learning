# Polymarket 数据分析笔记本中文说明

本文档概述了 `poly_data` 项目中的三个主要 Jupyter notebook 的功能和使用方法。

## 笔记本列表

### 1. Example 1 Trader Analysis.ipynb（交易者分析）

**用途**：分析特定交易者在 Polymarket 上的交易表现

**主要功能**：
- 加载和预处理 Polymarket 市场数据
- 分析交易者匹配统计（平均每笔接受者订单匹配的发起者数量）
- 可视化交易量分布
- 计算交易者的投资组合表现（PnL）

**关键分析指标**：
- 平均每笔接受者订单匹配 2.21 个发起者
- 中位数匹配数为 2.00
- 54.4% 的交易量来自 2 个发起者匹配的订单

**预定义交易者**：
```python
USERS = {
    'domah': '0x9d84ce0306f8551e02efef1680475fc0f1dc1344',
    '50pence': '0x3cf3e8d5427aed066a7a5926980600f6c3cf87b3',
    'fhantom': '0x6356fb47642a028bc09df92023c35a21a0b41885',
    'car': '0x7c3db723f1d4d8cb9c550095203b686cb11e5c6b',
    'theo4': '0x56687bf447db6ffa42ffe2204a05edaa20f55839',
    'aenews2': '0x44c1dfe43260c94ed4f1d00de2e1f80fb113ebc1'
}
```

**分析流程**：
1. 加载市场数据和交易数据
2. 按交易哈希分组统计发起者匹配数量
3. 计算交易量和分布
4. 筛选特定交易者的交易
5. 计算投资组合指标：
   - 买入/卖出美元金额
   - 买入/卖出代币数量
   - 现金盈亏（Cash PnL）
   - 库存代币（Inventory Tokens）
   - 未实现盈亏（Unrealized PnL）
   - 总盈亏（Total PnL）

### 2. Example 2 Backtest.ipynb（回测分析）

**用途**：使用历史交易数据执行交易策略回测

**主要功能**：
- 加载历史交易数据
- 实现交易策略逻辑
- 计算策略收益和风险指标
- 生成回测报告和可视化

**典型分析内容**：
- 策略信号生成
- 回测性能指标（收益率、夏普比率、最大回撤等）
- 交易统计（胜率、平均盈亏比等）
- 策略参数优化

### 3. Isolated.ipynb（独立分析）

**用途**：进行独立的探索性数据分析或特定主题研究

**主要功能**：
- 灵活的数据分析框架
- 自定义查询和分析
- 数据可视化
- 假设检验

**使用场景**：
- 市场趋势分析
- 异常交易检测
- 流动性研究
- 季节性模式识别

## 使用方法

### 环境准备
```bash
# 安装依赖
uv sync --extra dev

# 启动 Jupyter
uv run jupyter notebook
```

### 数据加载
所有笔记本都使用以下通用数据加载模式：

```python
import pandas as pd
import polars as pl
from poly_utils import get_markets, PLATFORM_WALLETS

# 加载市场数据
markets_df = get_markets()

# 加载交易数据
df = pl.scan_csv("processed/trades.csv").collect(streaming=True)
df = df.with_columns(
    pl.col("timestamp").str.to_datetime().alias("timestamp")
)
```

### 数据结构

**市场数据 (markets.csv)**：
- 包含市场元数据（问题、结果、代币等）
- 约 158,760 个唯一市场

**交易数据 (processed/trades.csv)**：
- 结构化的交易记录
- 包含价格、金额、方向等关键信息

## 重要注意事项

1. **数据完整性**：首次使用建议下载数据快照以节省收集时间
2. **性能优化**：使用 Polars 的流式处理处理大型数据集
3. **交易者分析**：在分析特定用户交易时，应按 `maker` 列筛选
4. **价格标准化**：所有金额已标准化（除以 10^6）

## 扩展分析

这些笔记本可以作为更复杂分析的基础：
- 机器学习预测模型
- 风险管理框架
- 投资组合优化
- 市场微观结构研究

## 相关资源

- [Polymarket 官方文档](https://docs.polymarket.com/)
- [数据模式说明](./README_zh.md)
- [API 文档](https://gamma-api.polymarket.com/)
